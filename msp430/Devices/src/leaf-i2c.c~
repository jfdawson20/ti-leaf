#include <stdio.h>
#include "leaf-I2c.h"


int16_t Leaf_I2C_Init(struct Leaf_I2C_Bus bus, uint8_t mode, uint8_t speed, uint8_t slaveAddr)
{	
	int16_t ret = 0;	

	bus.current_speed = speed;
	bus.status 	  = STATUS_DISABLED;
	bus.mode   	  = mode;

	if (mode == MODE_MASTER)
	{
		EUCSI_B_I2C_initMasterParam masterInit;

		//set clock source based off of board config
		masterInit.selectClockSource = GetClockSource(I2C_CLK);
	
		//set frequency based off of board config
		masterInit.i2cClk = getClockSpeed(I2C_CLK);
		
		//set data rate based off of user config
		if(speed == SPEED_400K)
			masterInit.dataRate = EUSCI_B_I2C_SET_DATA_RATE_400KBPS;

		else
			masterInit.dataRate = EUSCI_B_I2C_SET_DATA_RATE_100KBPS;

		//byte threshold feature not used currently
		masterInit.byteCounterThreshold = 0x00;
		masterInit.autoSTOPGeneration	= EUSCI_B_I2C_NO_AUTO_STOP;

		//initialize Master Address
		USCI_B_I2C_initMaster(I2C_BASE, masterInit);
	
	}
	else
	{
		//initialize Slave Address
		USCI_B_I2C_initSlave(I2C_BASE, slaveAddr);	
	}	

	//enable I2C
	USCI_B_I2C_Enable(I2C_BASE);

	return 0;

}

/* End Of File*/
